"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[8311],{90823:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>u});var i=n(74848),r=n(28453),o=n(93859),l=n(19365);const s={sidebar_position:13},a="CLIP",c={id:"Robot_development/boxs/function/hobot_clip",title:"CLIP",description:"Introduction",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/05_Robot_development/03_boxs/function/hobot_clip.md",sourceDirName:"05_Robot_development/03_boxs/function",slug:"/Robot_development/boxs/function/hobot_clip",permalink:"/rdk_doc/en/Robot_development/boxs/function/hobot_clip",draft:!1,unlisted:!1,editUrl:"https://github.com/D-Robotics/rdk_doc/blob/main/docs/05_Robot_development/03_boxs/function/hobot_clip.md",tags:[],version:"current",sidebarPosition:13,frontMatter:{sidebar_position:13},sidebar:"tutorialSidebar",previous:{title:"Visual Inertial Odometry Algorithm",permalink:"/rdk_doc/en/Robot_development/boxs/function/hobot_vio"},next:{title:"Segment Anything",permalink:"/rdk_doc/en/Robot_development/boxs/function/mono_mobilesam"}},d={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Supported Platforms",id:"supported-platforms",level:2},{value:"Preparation",id:"preparation",level:2},{value:"RDK",id:"rdk",level:3},{value:"Dependency Installation",id:"dependency-installation",level:3},{value:"Model Download",id:"model-download",level:3},{value:"Usage",id:"usage",level:2},{value:"RDK",id:"rdk-1",level:3},{value:"Result Analysis",id:"result-analysis",level:2}];function p(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"clip",children:"CLIP"}),"\n","\n",(0,i.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://github.com/openai/CLIP/",children:"CLIP"})," is a multimodal machine learning model proposed by OpenAI. This model uses contrastive learning on large-scale image-text pairs to process both images and text, mapping them into a shared vector space. This example demonstrates the functionality of using CLIP for image management and text query on the RDK platform."]}),"\n",(0,i.jsxs)(t.p,{children:["Code repository:  (",(0,i.jsx)(t.a,{href:"https://github.com/D-Robotics/hobot_clip.git",children:"https://github.com/D-Robotics/hobot_clip.git"}),")"]}),"\n",(0,i.jsx)(t.p,{children:"Application scenario: Using CLIP image feature extractor to manage images, usr text or image to query images, etc."}),"\n",(0,i.jsx)(t.h1,{id:"component",children:"Component"}),"\n",(0,i.jsx)(t.p,{children:"The project consists of four parts."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://github.com/D-Robotics/hobot_clip/tree/develop/clip_encode_image",children:"clip_encode_image"}),": an dnn node for the CLIP image encoder, currently supporting two modes:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Local mode: Supports input backpropagation, outputting text encoding features."}),"\n",(0,i.jsx)(t.li,{children:"Service mode: Based on ROS Action Server, supports client nodes sending inference requests and calculating the returned text encoding features."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://github.com/D-Robotics/hobot_clip/tree/develop/clip_encode_text",children:"clip_encode_text"}),": an dnn node for the CLIP text encoder, currently supporting two modes:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Local mode: Supports input backpropagation, outputting text encoding features."}),"\n",(0,i.jsx)(t.li,{children:"Service mode: Based on ROS Action Server, supports client nodes sending inference requests and calculating the returned text encoding features."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://github.com/D-Robotics/hobot_clip/tree/develop/clip_manage",children:"clip_manage"}),": CLIP relay node responsible for clienting and servicing. Currently, it supports two modes:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Storage mode: Send encoding requests to the image encoding node clip_encode_image, retrieve image encoding features from the target folder, and store the image encoding features in the local SQLite database."}),"\n",(0,i.jsx)(t.li,{children:"Query mode: Send an encoding request to the text encoding node clip_encode_text to obtain the encoding features of the target text. Next step, match the text features with image features in the database to obtain the matching results."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://github.com/D-Robotics/hobot_clip/tree/develop/clip_msgs",children:"clip_msgs"}),": CLIP app topic definition, action server control msg definition\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"supported-platforms",children:"Supported Platforms"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Platform"}),(0,i.jsx)(t.th,{children:"System"}),(0,i.jsx)(t.th,{children:"Function"})]})}),(0,i.jsx)(t.tbody,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"RDK X5"}),(0,i.jsx)(t.td,{children:"Ubuntu 22.04 (Humble)"}),(0,i.jsx)(t.td,{children:"Start CLIP Storage/Query mode, Storage database saved locally while query results display on the Web"})]})})]}),"\n",(0,i.jsx)(t.h2,{id:"preparation",children:"Preparation"}),"\n",(0,i.jsx)(t.h3,{id:"rdk",children:"RDK"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"The RDK has burned the  Ubuntu 22.04 system image provided by D-Robotics."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"The RDK has successfully installed TogetheROS.Bot."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"dependency-installation",children:"Dependency Installation"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"pip3 install onnxruntime\npip3 install ftfy\npip3 install wcwidth\npip3 install regex\n"})}),"\n",(0,i.jsx)(t.h3,{id:"model-download",children:"Model Download"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"# Download the model file from the web.\nwget http://archive.d-robotics.cc/models/clip_encode_text/text_encoder.tar.gz\nsudo tar -xf text_encoder.tar.gz -C config\n"})}),"\n",(0,i.jsx)(t.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(t.h3,{id:"rdk-1",children:"RDK"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Mode One: Storage"})}),"\n",(0,i.jsx)(t.p,{children:'Set clip_mode to "0" to store the image files from the "/root/config" directory into the "clip.db" database.'}),"\n",(0,i.jsx)(t.p,{children:'(Users can change the image folder path "clip_storage_folder" and the database name "clip_db_file" as needed. It is recommended to use absolute paths.)'}),"\n",(0,i.jsx)(o.A,{groupId:"tros-distro",children:(0,i.jsx)(l.A,{value:"humble",label:"Humble",children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"# Configure the tros.b environment\nsource /opt/tros/humble/setup.bash\n\n# Copy the configuration file required for running the example from the installation path of tros.b.\ncp -r /opt/tros/${TROS_DISTRO}/lib/clip_encode_image/config/ .\n\n# Start the launch file\nros2 launch clip_manage hobot_clip_manage.launch.py clip_mode:=0 clip_db_file:=clip.db clip_storage_folder:=/root/config\n"})})})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Mode Two: Query"})}),"\n",(0,i.jsx)(t.p,{children:'Set clip_mode to "1", set database path to "clip.db" and set query text "a diagram". the query result is saved in "result" folder.'}),"\n",(0,i.jsx)(t.p,{children:'(Users can change the database name "clip_db_file", query text "clip_text", and query result path "clip_result_folder" as needed. It is recommended to use absolute paths.)'}),"\n",(0,i.jsx)(o.A,{groupId:"tros-distro",children:(0,i.jsx)(l.A,{value:"humble",label:"Humble",children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:'# Configure the tros.b environment\nsource /opt/tros/humble/setup.bash\n\n# Start the launch file\nros2 launch clip_manage hobot_clip_manage.launch.py clip_mode:=1 clip_db_file:=clip.db clip_result_folder:=result clip_text:="a diagram"\n'})})})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Display Query Result"})}),"\n",(0,i.jsx)(t.p,{children:"Run command in another terminal:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"cp -r /opt/tros/${TROS_DISTRO}/lib/clip_manage/config/index.html .\npython -m http.server 8080\n"})}),"\n",(0,i.jsx)(t.h2,{id:"result-analysis",children:"Result Analysis"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Mode One: Storage"})}),"\n",(0,i.jsx)(t.p,{children:"The following information will be displayed in the terminal:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"[clip_manage-3] [WARN] [0000434374.492834334] [image_action_client]: Action client recved goal\n[clip_manage-3] [WARN] [0000434374.493161250] [image_action_client]: Action client got lock\n[clip_manage-3] [WARN] [0000434374.493402834] [image_action_client]: Sending goal, type: 1, urls size: 0\n[clip_encode_image-1] [WARN] [0000434374.494557250] [encode_image_server]: Received goal request with type: 1\n[clip_encode_image-1] [WARN] [0000434374.495408375] [encode_image_server]: Executing goal\n[clip_encode_image-1] [WARN] [0000434379.674204836] [ClipImageNode]: Sub img fps: 1.58, Smart fps: 1.58, preprocess time ms: 1422, infer time ms: 218, post process time ms: 0\n[clip_encode_image-1] [WARN] [0000434380.881684628] [ClipImageNode]: Sub img fps: 3.31, Smart fps: 3.31, preprocess time ms: 44, infer time ms: 216, post process time ms: 0\n[clip_encode_image-1] [WARN] [0000434380.882277045] [encode_image_server]: Goal complete, task_result: 1\n[clip_manage-3] [WARN] [0000434381.704573129] [image_action_client]: Get Result errorcode: 0\n[clip_manage-3] [WARN] [0000434381.704934504] [ClipNode]: Storage finish, current num of database: 7.\n"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Mode Two: Query"})}),"\n",(0,i.jsx)(t.p,{children:"The following information will be displayed in the terminal:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"[clip_manage-3] [WARN] [0000435148.509009119] [ClipNode]: Query start, num of database: 7.\n[clip_manage-3] [WARN] [0000435148.509820786] [ClipNode]: Query finished! Cost 1 ms.\n[clip_encode_text_node-2] [WARN] [0000435148.514026703] [clip_encode_text_node]: Clip Encode Text Node work success.\n[clip_manage-3] [WARN] [0000435148.532558536] [ClipNode]: Query Result config/CLIP.png, similarity: 0.289350\n[clip_manage-3] [WARN] [0000435148.540040328] [ClipNode]: Query Result config/dog.jpg, similarity: 0.228837\n[clip_manage-3] [WARN] [0000435148.547667078] [ClipNode]: Query Result config/target_class.jpg, similarity: 0.224744\n[clip_manage-3] [WARN] [0000435148.555092286] [ClipNode]: Query Result config/target.jpg, similarity: 0.207572\n[clip_manage-3] [WARN] [0000435148.562450494] [ClipNode]: Query Result config/raw_unet.jpg, similarity: 0.198459\n[clip_manage-3] [WARN] [0000435148.569500536] [ClipNode]: Query Result config/people.jpg, similarity: 0.174074\n[clip_manage-3] [WARN] [0000435148.576885453] [ClipNode]: Query Result config/test.jpg, similarity: 0.174074\n[clip_manage-3] [WARN] [0000435148.584450703] [text_action_client]: Get Result errorcode: 0\n"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Display Query Result"})}),"\n",(0,i.jsxs)(t.p,{children:["Use Google Chrome or Edge and enter ",(0,i.jsx)(t.a,{href:"http://IP:8080",children:"http://IP:8080"})," to view the image retrieval results (where IP is the device's IP address)."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:n(99803).A+"",width:"1920",height:"937"})}),"\n",(0,i.jsx)(t.p,{children:"Result Analysis: You can sequentially see the retrieval results based on the similarity between the query text and images. Among them, only the CLIP.png image is provided for this example, while the other images are from the user's actual configuration. Therefore, it is expected that only the first image in the visualization result will be the same as in the example."})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},19365:(e,t,n)=>{n.d(t,{A:()=>l});n(96540);var i=n(34164);const r={tabItem:"tabItem_Ymn6"};var o=n(74848);function l(e){let{children:t,hidden:n,className:l}=e;return(0,o.jsx)("div",{role:"tabpanel",className:(0,i.A)(r.tabItem,l),hidden:n,children:t})}},93859:(e,t,n)=>{n.d(t,{A:()=>y});var i=n(96540),r=n(34164),o=n(86641),l=n(56347),s=n(205),a=n(38874),c=n(24035),d=n(82993);function u(e){return i.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:t,children:n}=e;return(0,i.useMemo)((()=>{const e=t??function(e){return u(e).map((e=>{let{props:{value:t,label:n,attributes:i,default:r}}=e;return{value:t,label:n,attributes:i,default:r}}))}(n);return function(e){const t=(0,c.X)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function h(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:n}=e;const r=(0,l.W6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,a.aZ)(o),(0,i.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(r.location.search);t.set(o,e),r.replace({...r.location,search:t.toString()})}),[o,r])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,o=p(e),[l,a]=(0,i.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!h({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const i=n.find((e=>e.default))??n[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:t,tabValues:o}))),[c,u]=m({queryString:n,groupId:r}),[g,b]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,o]=(0,d.Dv)(n);return[r,(0,i.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:r}),f=(()=>{const e=c??g;return h({value:e,tabValues:o})?e:null})();(0,s.A)((()=>{f&&a(f)}),[f]);return{selectedValue:l,selectValue:(0,i.useCallback)((e=>{if(!h({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);a(e),u(e),b(e)}),[u,b,o]),tabValues:o}}var b=n(92303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=n(74848);function _(e){let{className:t,block:n,selectedValue:i,selectValue:l,tabValues:s}=e;const a=[],{blockElementScrollPositionUntilNextRender:c}=(0,o.a_)(),d=e=>{const t=e.currentTarget,n=a.indexOf(t),r=s[n].value;r!==i&&(c(t),l(r))},u=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=a.indexOf(e.currentTarget)+1;t=a[n]??a[0];break}case"ArrowLeft":{const n=a.indexOf(e.currentTarget)-1;t=a[n]??a[a.length-1];break}}t?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},t),children:s.map((e=>{let{value:t,label:n,attributes:o}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,ref:e=>a.push(e),onKeyDown:u,onClick:d,...o,className:(0,r.A)("tabs__item",f.tabItem,o?.className,{"tabs__item--active":i===t}),children:n??t},t)}))})}function j(e){let{lazy:t,children:n,selectedValue:r}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===r));return e?(0,i.cloneElement)(e,{className:"margin-top--md"}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==r})))})}function v(e){const t=g(e);return(0,x.jsxs)("div",{className:(0,r.A)("tabs-container",f.tabList),children:[(0,x.jsx)(_,{...t,...e}),(0,x.jsx)(j,{...t,...e})]})}function y(e){const t=(0,b.A)();return(0,x.jsx)(v,{...e,children:u(e.children)},String(t))}},99803:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/query_display-7b55cb00eb65f86fef804ac0e78df38e.png"},28453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>s});var i=n(96540);const r={},o=i.createContext(r);function l(e){const t=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);